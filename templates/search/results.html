{% extends (craft.app.request.isAjax and not craft.app.request.isLivePreview) ? "_ajax-layout" : "_layout" %}

{% set title = "Search Results" %}
{% set bodyClass = 'page page-search-results' %}

{% set query = craft.request.getParam('q') %}
{% set entries = craft.entries().search(query).section('blog').order('score') %}

{% block content %}

  {% if not craft.app.request.isAjax %}

    <section class="intro-section">
      <div class="grid">
        <h2 class="page-description">
          {{ entries|length }} results found for “{{ query }}”:
        </h2>

        <div class="subscribe">
          <h4>Subscribe</h4>
          <p><a href="#" class="inline-link"><span>Get our blog posts delivered straight to your inbox.</span></a></p>
        </div>
      </div>

      <div class="filter-section grid">

          <div class="search col-1-2">
            <form action="{{ url('search') }}">

            <div class="search-wrap">
              <input type="search" name="q" placeholder="Search Posts">
              <button type="submit" class="svg-inject" data-icon="icon-search"><span class="visually-hidden">Search Posts</span></button>
            </div>

            </form>

          </div>

          <div class="col-1-2 grid">

            <div class="filter category col-1-2">
              <div class="select-wrap">
                <select name="category" id="category">
                  <option value="null">Category</option>
                  {% for category in craft.categories.group('blogCategories') %}
                    <option value="{{ category.title }}">{{ category.title }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            {% set entries = craft.entries.section('blogEntries').limit(null) %}
            <div class="filter tag col-1-2">
              <div class="select-wrap">
                <select name="tag" id="tag">
                  <option value="null">Tag</option>
                  {% for tag in craft.tags.relatedTo(entries) %}
                    <option value="{{ tag.title }}">{{ tag.title }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

          </div>

      </div>

    </section>

  {% endif %}

  {% if entries|length %}
    <div class="article-list">

      {% for entry in entries %}
        {% include "blog/_article" %}
      {% endfor %}

    </div>
  {% else %}
    <p>Your search for “{{ query }}” didn’t return any results.</p>
  {% endif %}

{% endblock %}