{% set postType = post.section.handle == 'resourcesEntries' ? 'resources' : 'ideas' %}
{% set isFeatured = featured is defined and featured == true ? true : false %}
{% set isPublication = publication is defined and publication == true ? true : false %}

<article class="post-card{{ isFeatured ? ' featured-post' : '' }}{{ postClass is defined ? ' ' ~ postClass : '' }}">
  <div class="-inner">
    {% if isFeatured or isPublication %}
    <div class="ribbons">
      {% if isFeatured %}
        <svg class="featured-ribbon" width="35" height="45" viewBox="0 0 35 45" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#featured-ribbon-clip)"><path fill-rule="evenodd" clip-rule="evenodd" d="M35 0H0V35V42.0136C0 43.4371 1.44516 44.4049 2.7615 43.8629L17 38H18L32.2385 43.8629C33.5548 44.4049 35 43.4371 35 42.0136V35V0Z" fill="#F7CC0D"/><mask id="path-3-inside-1" fill="white"><path fill-rule="evenodd" clip-rule="evenodd" d="M35 -2H0V35V42.0136C0 43.4371 1.44516 44.4049 2.7615 43.8629L17 38H18L32.2385 43.8629C33.5548 44.4049 35 43.4371 35 42.0136V35V-2Z"/></mask><path d="M0 -2V-4H-2V-2H0ZM35 -2H37V-4H35V-2ZM2.7615 43.8629L2 42.0136L2 42.0136L2.7615 43.8629ZM17 38V36H16.6043L16.2385 36.1506L17 38ZM18 38L18.7615 36.1506L18.3957 36H18V38ZM32.2385 43.8629L33 42.0136V42.0136L32.2385 43.8629ZM0 0H35V-4H0V0ZM2 35V-2H-2V35H2ZM2 42.0136V35H-2V42.0136H2ZM2 42.0136H2H-2C-2 44.8607 0.89031 46.7963 3.523 45.7123L2 42.0136ZM16.2385 36.1506L2 42.0136L3.523 45.7123L17.7615 39.8494L16.2385 36.1506ZM18 36H17V40H18V36ZM33 42.0136L18.7615 36.1506L17.2385 39.8494L31.477 45.7123L33 42.0136ZM33 42.0136L31.477 45.7123C34.1097 46.7963 37 44.8607 37 42.0136H33ZM33 35V42.0136H37V35H33ZM33 -2V35H37V-2H33Z" fill="white" mask="url(#path-3-inside-1)"/><path d="M16.7867 14.1953C17.0112 13.5043 17.9888 13.5043 18.2133 14.1953L19.0155 16.6641C19.1159 16.9732 19.4038 17.1824 19.7288 17.1824H22.3247C23.0512 17.1824 23.3533 18.1121 22.7655 18.5391L20.6654 20.065C20.4025 20.2559 20.2925 20.5945 20.3929 20.9035L21.1951 23.3723C21.4196 24.0633 20.6288 24.6379 20.041 24.2109L17.9408 22.685C17.678 22.4941 17.322 22.4941 17.0592 22.685L14.959 24.2109C14.3712 24.6379 13.5804 24.0633 13.8049 23.3723L14.6071 20.9035C14.7075 20.5945 14.5975 20.2559 14.3346 20.065L12.2345 18.5391C11.6467 18.1121 11.9488 17.1824 12.6753 17.1824H15.2712C15.5962 17.1824 15.8841 16.9732 15.9845 16.6641L16.7867 14.1953Z" fill="#1C1F21"/></g><defs><clipPath id="featured-ribbon-clip"><path d="M0 0H35V45H0V0Z" fill="white"/></clipPath></defs></svg>
      {% endif %}
      {% if isPublication %}
        <svg class="publication-ribbon" width="35" height="45" viewBox="0 0 35 45" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#publication-ribbon-clip)"><path fill-rule="evenodd" clip-rule="evenodd" d="M35 0H0V35V42.0136C0 43.4371 1.44516 44.4049 2.7615 43.8629L17 38H18L32.2385 43.8629C33.5548 44.4049 35 43.4371 35 42.0136V35V0Z" fill="#1C1F21"/><mask id="path-3-inside-1" fill="white"><path fill-rule="evenodd" clip-rule="evenodd" d="M35 -2H0V35V42.0136C0 43.4371 1.44516 44.4049 2.7615 43.8629L17 38H18L32.2385 43.8629C33.5548 44.4049 35 43.4371 35 42.0136V35V-2Z"/></mask><path d="M0 -2V-4H-2V-2H0ZM35 -2H37V-4H35V-2ZM2.7615 43.8629L2 42.0136L2 42.0136L2.7615 43.8629ZM17 38V36H16.6043L16.2385 36.1506L17 38ZM18 38L18.7615 36.1506L18.3957 36H18V38ZM32.2385 43.8629L33 42.0136V42.0136L32.2385 43.8629ZM0 0H35V-4H0V0ZM2 35V-2H-2V35H2ZM2 42.0136V35H-2V42.0136H2ZM2 42.0136H2H-2C-2 44.8607 0.89031 46.7963 3.523 45.7123L2 42.0136ZM16.2385 36.1506L2 42.0136L3.523 45.7123L17.7615 39.8494L16.2385 36.1506ZM18 36H17V40H18V36ZM33 42.0136L18.7615 36.1506L17.2385 39.8494L31.477 45.7123L33 42.0136ZM33 42.0136L31.477 45.7123C34.1097 46.7963 37 44.8607 37 42.0136H33ZM33 35V42.0136H37V35H33ZM33 -2V35H37V-2H33Z" fill="white" mask="url(#path-3-inside-1)"/><path d="M15 13.5C16.5 13.5 17.5 14.5 17.5 16V24C17.5 22.5 16.5 21.5 15 21.5H12.5V13.5H15Z" stroke="white" stroke-linejoin="round"/><path d="M20 13.5C18.5 13.5 17.5 14.5 17.5 16V24C17.5 22.5 18.5 21.5 20 21.5H22.5V13.5H20Z" stroke="white" stroke-linejoin="round"/><path d="M10.5 15V23.5H14.5C15.0523 23.5 15.5 23.9477 15.5 24.5V25.5H19.5V24.5C19.5 23.9477 19.9477 23.5 20.5 23.5H24.5V15" stroke="white" stroke-linejoin="round"/></g><defs><clipPath id="publication-ribbon-clip"><path d="M0 0H35V45H0V0Z" fill="white"/></clipPath></defs></svg>
      {% endif %}
    </div>
    {% endif %}

    {% if isFeatured and postClass is defined and postClass != 'col-1-3' %}
      {% set width = 1000 %}
      {% set height = 1240 %}
    {% else %}
      {% set width = 960 %}
      {% set height = 480 %}
    {% endif %}
    {% if postType == 'resources'  %}
      {% set parentSlug = 'resources' %}
      {% set categories = post.resourceTopic %}
      {% set categorySlug = 'topic' %}
      {% set tags = post.resourceLocations %}
      {% set tagSlug = 'location' %}
      {% set transformedImage = craft.imager.transformImage(post.resourcesBannerImage.one(), { width: width, height: height }) %}
    {% else %}
      {% set parentSlug = 'ideas' %}
      {% set categories = post.ideasCategory %}
      {% set categorySlug = 'category' %}
      {% set tags = post.ideasTags %}
      {% set tagSlug = 'tag' %}
      {% set transformedImage = craft.imager.transformImage(post.ideasBannerImage.one(), { width: width, height: height }) %}
    {% endif %}

    <div class="post-image" style="background-image:url({{ transformedImage.getUrl() }});"></div>
    <div class="post-content">
      <h4 class="post-title"><a href="{{ post.url }}">{{ post.title }}</a></h4>
      <p class="post-excerpt">{{ post.excerpt }}</p>
      <div class="post-meta">
        <p class="post-date"><svg class="icon icon-calendar" aria-hidden="true" role="presentation"><use xlink:href="#icon-calendar"/></svg> {{ post.postDate.format('M d, Y') }}</p>

        {% if post.ageGroups|length %}
          {% if post.ageGroups|length > 1 %}
            {% set ageRanges = [] %}
            {% for ageGroup in post.ageGroups.all() %}
              {% set ages = ageGroup.ageRange|replace('+', '')|split('-') %}
              {% for age in ages %}
                {% set ageRanges = ageRanges|merge([age]) %}
              {% endfor %}
            {% endfor %}
            {% set lowAge = min(ageRanges) %}
            {% set highAge = max(ageRanges) %}
            {% set ageText = lowAge ~ '-' ~ highAge %}
          {% else %}
            {% set ageText = post.ageGroups.one().ageRange %}
          {% endif %}
          <p class="age-range"><svg class="icon icon-person" aria-hidden="true" role="presentation"><use xlink:href="#icon-person"/></svg>Ages {{ ageText }}</p>
        {% endif %}

        {% if categories|length %}
          <div class="post-categories">
            <ul>
              {% if postType == 'ideas' %}
                <svg class="icon icon-category" aria-hidden="true" role="presentation"><use xlink:href="#icon-category"/></svg>
              {% else %}
                <svg class="icon icon-tag" aria-hidden="true" role="presentation"><use xlink:href="#icon-tag"/></svg>
              {% endif %}
              {% for category in categories.all() %}
                <li><a href="{{ url(parentSlug ~ '/all?' ~ categorySlug ~ '=' ~ category.slug) }}">{{ category.title }}</a>{{ loop.index < categories|length ? ', ' : '' }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        {% if tags|length %}
          <div class="post-tags">
            <ul>
              {% if postType == 'resources' %}
                <svg class="icon icon-location" aria-hidden="true" role="presentation"><use xlink:href="#icon-location"/></svg>
              {% else %}
                <svg class="icon icon-tag" aria-hidden="true" role="presentation"><use xlink:href="#icon-tag"/></svg>
              {% endif %}
              {% for tag in tags.all() %}
                <li><a href="{{ url(parentSlug ~ '/all?' ~ tagSlug ~ '=' ~ tag.slug) }}">{{ tag.title }}</a>{{ loop.index < tags|length ? ', ' : '' }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>
      <p class="cta"><a href="{{ post.url }}" class="inline-link -blue"><span>Read More</span></a></p>
    </div>
  </div>
</article>