{% extends (craft.request.isAjax and not craft.request.isLivePreview) ? "_ajax-layout" : "_layout" %}

{% set title = entry.title %}
{% set bodyClass = 'page sidebar-left single-post' %}

{% if entry.seoTitle %}{% set seoTitle = entry.seoTitle %}{% endif %}
{% if entry.seoDescription %}{% set seoDescription = entry.seoDescription %}{% endif %}

{% if entry.postDate.year == "now"|date("Y") %}
  {% set entryDate = entry.postDate.format('M d') %}
{% else %}
  {% set entryDate = entry.postDate.format('m/d/y') %}
{% endif %}

{% block content %}
  {% set bannerImage = entry.blogBannerImage.last() %}
  <article class="entry grid">

    {% include "partials/_page-sidebar" with { 'parent' : craft.entries.section('blog').first()} %}

    <div class="entry-body col-2-3">    
      {% if entry.videoId|length %}
        <div class="featured-image has-video">
          <svg class="play icon icon-arrow-stroke" role="img"><use xlink:href="#icon-arrow-stroke" /></svg>
          <div class="image" style="background-image:url({{ bannerImage.getUrl('hero') }});"></div>
          <iframe id="yt-{{ entry.id }}" class="youtube-video" width="100%" src="https://www.youtube.com/embed/{{ entry.videoId }}?enablejsapi=1&modestbranding=1&rel=0" frameborder="0" allowfullscreen></iframe>
        </div>
      {% else %}
        <div class="featured-image" style="background-image:url({{ bannerImage.getUrl('hero') }});"></div>
      {% endif %}

      <header class="entry-header">
        <h3 class="article-date">{{ entryDate }}</h3>
        <p class="category">{{ entry.blogPostType.first() }}</p>
        <h1>{{ entry.title }}</h1>

        <div class="entry-meta grid">
          <div class="entry-author col-1-2">
            {% if entry.author.photoUrl %}
            <div class="author-image">
              <img src="{{ entry.author.photoUrl }}" alt="{{ entry.author.name }}">
            </div>
            {% endif %}
            <h5 class="author-content">
              <span>Author:</span>
              {{ entry.author.name }}
            </h5>
          </div>

          <div class="entry-cats-tags col-1-2">
            <div>
              <h5>Category:</h5>
              <ul>
                {% for category in entry.blogCategory %}
                  <li><a href="{{ category.url }}">{{ category.title }}</a></li>
                {% endfor %}
              </ul>
            </div>

            {% if entry.blogTags|length %}
            <div>
              <h5>Tags:</h5>
              <ul>
                {% for tag in entry.blogTags %}
                  <li><a href="{{ url('blog/tag/'~tag.slug) }}">{{ tag.title }}</a></li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
          </div>
          
        </div>


        {# <%= render partial: '/shared/edit_bug', :locals => { :obj => news_post, :edit_path => refinery.edit_news_posts_admin_news_post_path(news_post) }%> #}
      </header>

      <div class="entry-content user-content">
        {{ entry.body }}

        {% if entry.resourceDownloads|length %}
          <div class="resource-downloads">

            {% for resource in entry.resourceDownloads.resource %}
              <div class="resource-download">
                {% if resource.resourceThumbnail|length %}
                  <a class="download-thumb" href="{{ resource.resourceFile.first().getUrl() }}">
                    <img src="{{ resource.resourceThumbnail.first().getUrl('thumbnail') }}" alt="{{ resource.resourceTitle }}">
                  </a>
                {% endif %}
                <div class="resource-info">
                  <h3>{{ resource.resourceTitle }}</h3>
                  {% if resource.resourceDescription %}
                    {{ resource.resourceDescription }}
                  {% endif %}

                  <div class="resource-link">
                    <a href="{{ resource.resourceFile.first().getUrl() }}" class="inline-link" target="_blank"><span>Download resource</span></a>
                  </div>
                </div>
              </div>
            {% endfor %}

          </div>
        {% endif %}
      </div>

      <div class="share-section">
        <h6>Share:</h6>
        <ul>
          <li><a class="share" href="https://www.facebook.com/sharer/sharer.php?u={{ entry.url }}"><span class="visually-hidden">facebook</span><svg class="icon icon-facebook" role="img"><use xlink:href="#icon-facebook" /></svg></a></li>
          <li><a class="share" href="http://twitter.com/share?url=http://{{ entry.url }}&amp;text={{ entry.title }} via @ednavigate" target="_blank"><span class="visually-hidden">Twitter</span><svg class="icon icon-twitter" role="img"><use xlink:href="#icon-twitter" /></svg></a></li>
        </ul>
      </div>          

      <div class="section-links">
        {% include 'partials/_entry-nav.html' %}
      </div>

    </div>

    <aside class="sidebar col-1-3">
      {% set relatedEntries = craft.entries.section('blogEntries').relatedTo(['or', {targetElement: entry.blogCategory}, {targetElement: entry.blogTags}]).id('not ' ~ entry.id) %}
      {% if relatedEntries|length %}
      <h4>Related Posts</h4>
      <ul class="related-posts">
        {% for relatedEntry in relatedEntries.limit(2) %}
          <li>
            <a class="inline-link" href="{{ relatedEntry.url }}"><span>{{ relatedEntry.title }}</span></a>
          </li>
        {% endfor %}
      </ul>
      {% endif %}
    </aside>

  </article>

  {% include 'partials/_googletranslate.html' %}
{% endblock %}